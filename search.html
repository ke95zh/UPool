<html lang="en">
	<head>
		<title>UPool</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel="stylesheet" href="test.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	</head>
	<body>
  
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>                        
					</button>
					<a class="navbar-brand" href="#">UPool</a>
				</div>
				<div class="collapse navbar-collapse" id="myNavbar">
					<ul class="nav navbar-nav">
						<li class="active"><a href="#">Riders</a></li>
						<li><a href="#">Drivers</a></li>
					</ul>
					
					<div class="dropdown navbar-right">
					<button class="dropbtn">Profile &#9660;</button>
					<div class="dropdown-content">
					  <a href="#">My UPOOL</a>
					  <a href="#">Settings</a>
					  <a href="#">Log out</a>
					</div>
				  </div>
				</div>
			</div>
		</nav>
		
		<div class="sidebar">
			<br />
			&nbsp;&nbsp;<input type="search" id="start" placeholder="Choose starting location...">
			<div class="error" id="starterror">&nbsp;</div>
			&nbsp;&nbsp;<input type="search" id="destination" placeholder="Choose destination...">
			<div class="error" id="destinationerror">&nbsp;</div>
			&nbsp;&nbsp;Date:&nbsp;<input type="date" id="date" min="2017-5-1">&nbsp;&nbsp;
			&nbsp;&nbsp;<input type="checkbox" id="repeat" value="repeat">&nbsp;&nbsp;Repeat Weekly?
			<div class="error" id="dateerror">&nbsp;</div>
			&nbsp;&nbsp;Start Time:&nbsp;<input type="time" id="starttime" step="300">
			&nbsp;&nbsp;Arrival Time:&nbsp;<input type="time" id="arrivaltime" step="300"><br />
			<div class="error" id="timeerror">&nbsp;</div>
			&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<button onclick="processData();">Make carpool</button>
		</div>
		
		<div class="body">
			<div id="map"></div>
		</div>
		<script>
			//Date functions(restrict people form picking past dates)
			//
			
			//Google Maps initialization, requesting location services from user
			var map, infoWindow, marker = null, markerA = null, markerB = null;
			var geocoder;
			var directionsDisplay;
			var directionsService;
			var pointA = null, pointB = null;
			
			function initMap() {
				geocoder = new google.maps.Geocoder();
				directionsDisplay = new google.maps.DirectionsRenderer();
				directionsService = new google.maps.DirectionsService();
				map = new google.maps.Map(document.getElementById('map'), {zoom: 17, center: {lat: 38.986918, lng: -76.942554}});
				marker = new google.maps.Marker({position: {lat: 38.986918, lng: -76.942554}, map: map});
				infoWindow = new google.maps.InfoWindow();
				directionsDisplay.setMap(map);
				
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position) {
						var pos = {lat: position.coords.latitude, lng: position.coords.longitude};
						
						infoWindow.setPosition(pos);
						map.setCenter(pos);
						marker.setMap(null);
						marker = new google.maps.Marker({pos, map: map});
					}, function() {
						handleLocationError(true, infoWindow, map.getCenter());
					});
				} else {
					handleLocationError(false, infoWindow, map.getCenter());
				}
				
				
				google.maps.event.addDomListener(window, "resize", function() {
					var center = map.getCenter();
					google.maps.event.trigger(map, "resize");
					map.setCenter(center); 
				 });
				google.maps.event.addDomListener(window, 'load', initMap);
			}
			
			function handleLocationError(browserHasGeolocation, infoWindow, pos) {
				infoWindow.setPosition(pos);
				infoWindow.setContent(browserHasGeolocation ? 'Error: The Geolocation service failed.' : 'Error: Your browser doesn\'t support geolocation.');
				infoWindow.open(map);
			}
		//Geocoding
			function codeStart() {
				var address = document.getElementById("start").value;
				geocoder.geocode( {'address' : address}, function(results, status) {
					if (status == 'OK') {
						marker.setMap(null);
						if (markerA !== null) {
							markerA.setMap(null);
						}
						pointA = results[0].geometry.location;
						map.setCenter(results[0].geometry.location);
						document.getElementById("start").value = results[0].formatted_address;
						markerA = new google.maps.Marker({map: map, position: results[0].geometry.location});
						if (pointB !== null) {
							directions();
						}
					} else {
						alert('Geocode was not successful for the following reason: ' + status);
					}
				});
			}
			
			function codeDestination() {
				var address = document.getElementById("destination").value;
				geocoder.geocode( {'address' : address}, function(results, status) {
					if (status == 'OK') {
						marker.setMap(null);
						if (pointB !== null) {
							markerB.setMap(null);
						}
						pointB = results[0].geometry.location;
						map.setCenter(results[0].geometry.location);
						document.getElementById("destination").value = results[0].formatted_address;
						markerB = new google.maps.Marker({map: map, position: results[0].geometry.location});
						if (pointA !== null) {
							directions();
						}
					} else {
						alert('Geocode was not successful for the following reason: ' + status);
					}
				});
			}
			
		//Showing directions
			
			function directions() {
				var request = {
					origin: pointA,
					destination: pointB,
					travelMode: google.maps.TravelMode.DRIVING
				};
				directionsService.route(request, function(response, status) {
					if (status == google.maps.DirectionsStatus.OK) {
						markerA.setMap(null);
						markerB.setMap(null);
						directionsDisplay.setDirections(response);
					}
				});
			}
			
		//Autocomplete initialization
			function initStartAutocomplete() {
				
			}
			
		//Verify data
			function processData() {
				var date = document.getElementById("date");
				var startTime = document.getElementById("starttime");
				var arrivalTime = document.getElementById("arrivaltime");
				var today = new Date().toISOString().split('T')[0];
				console.log(date.value);
				console.log(startTime.value);
				console.log(arrivalTime.value);
				console.log(today);
				
				if (pointA === null) {
					document.getElementById("starterror").innerHTML = "&nbsp;&nbsp;Enter a starting location";
				} else {
					document.getElementById("starterror").innerHTML = "&nbsp;";
				}
				if (pointB === null) {
					document.getElementById("destinationerror").innerHTML = "&nbsp;&nbsp;Enter a destination location";
				} else {
					document.getElementById("destinationerror").innerHTML = "&nbsp;";
				}
				if (date.value === "") {
					document.getElementById("dateerror").innerHTML = "&nbsp;&nbsp;Enter a date";
				} else if(date.value < today) {
					document.getElementById("dateerror").innerHTML = "&nbsp;&nbsp;Invalid date";
				} else {
					document.getElementById("dateerror").innerHTML = "&nbsp;";
				}
				if (startTime.value === "" && arrivalTime.value === "") {
					document.getElementById("timeerror").innerHTML = "&nbsp;&nbsp;Please enter a start or arrival time";
				} else {
					document.getElementById("timeerror").innerHTML = "&nbsp;";
				}
				
			}
			
			
			document.getElementById("start").addEventListener("keyup", function(event) {
				event.preventDefault();
				if (event.keyCode == 13) {
					codeStart();
				}
			});
			
			document.getElementById("destination").addEventListener("keyup", function(event) {
				event.preventDefault();
				if (event.keyCode == 13) {
					codeDestination();
				}
			});
			
		</script>
		<script async defer
				src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDGf2V7XQSqJgEyp4oinoyA3dCyzb-CHn4&callback=initMap">
			
		</script>
	</body>
</html>