<html lang="en">
	<head>
		<title>UPool</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel="stylesheet" href="test.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	</head>
	<body>
  
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>                        
					</button>
					<a class="navbar-brand" href="#">UPool</a>
				</div>
				<div class="collapse navbar-collapse" id="myNavbar">
					<ul class="nav navbar-nav">
						<li class="active"><a href="#">Riders</a></li>
						<li><a href="#">Drivers</a></li>
					</ul>
					<ul class="nav navbar-nav navbar-right">
						<div class="dropdown">
							<button class ="dropbtn" onclick="myFunction()"><span class="glyphicon glyphicon-user"></span> Profile &#9660;</button>
							<div id = "myDropdown" class="dropdown-content">
								<a href="#">My UPOOL</a>
								<a href="#">Settings</a>
								<a href="#">Log Out</a>
							</div>
							
						</div>
						<script>
							function myFunction() {
								document.getElementById("myDropdown").classList.toggle("show");
							}
							
							window.onclock = function(event) {
								var dropdowns = document.getElementsByClassName("dropdown-content");
								var i;
								for(i = 0; i <dropdowns.length;i++) {
									var openDropdown = dropdowns[i];
									if (openDropdown.classList.contains('show')) {
										openDropdown.classList.remove('show');
									}
								}
							};
						</script>
						
					</ul>
				</div>
			</div>
		</nav>
		
		<div class="sidebar">
			<br />
			&nbsp;&nbsp;<input type="search" id="start" placeholder="Choose starting location..."><br /><br />
			&nbsp;&nbsp;<input type="search" id="destination" placeholder="Choose destination..."><br /><br />
		</div>
		
		<div class="body">
			<div id="map"></div>
		</div>
		<script>
			//Google Maps initialization, requesting location services from user
			var map, infoWindow, marker = null, markerA = null, markerB = null;
			var geocoder;
			var directionsDisplay;
			var directionsService;
			var pointA = null, pointB = null;
			
			function initMap() {
				geocoder = new google.maps.Geocoder();
				directionsDisplay = new google.maps.DirectionsRenderer();
				directionsService = new google.maps.DirectionsService();
				map = new google.maps.Map(document.getElementById('map'), {zoom: 17, center: {lat: 38.986918, lng: -76.942554}});
				marker = new google.maps.Marker({position: {lat: 38.986918, lng: -76.942554}, map: map});
				infoWindow = new google.maps.InfoWindow;
				directionsDisplay.setMap(map);
				
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position) {
						var pos = {lat: position.coords.latitude, lng: position.coords.longitude};
						
						infoWindow.setPosition(pos);
						map.setCenter(pos);
						marker.setMap(null);
						marker = new google.maps.Marker({pos, map: map});
					}, function() {
						handleLocationError(true, infoWindow, map.getCenter());
					});
				} else {
					handleLocationError(false, infoWindow, map.getCenter());
				}
			}
			
			function handleLocationError(browserHasGeolocation, infoWindow, pos) {
				infoWindow.setPosition(pos);
				infoWindow.setContent(browserHasGeolocation ? 'Error: The Geolocation service failed.' : 'Error: Your browser doesn\'t support geolocation.');
				infoWindow.open(map);
			}
		//Geocoding
			function codeStart() {
				console.log("codeStart");
				var address = document.getElementById("start").value;
				geocoder.geocode( {'address' : address}, function(results, status) {
					if (status == 'OK') {
						marker.setMap(null);
						if (markerA !== null) {
							markerA.setMap(null);
						}
						pointA = results[0].geometry.location;
						map.setCenter(results[0].geometry.location);
						markerA = new google.maps.Marker({map: map, position: results[0].geometry.location});
						if (pointB !== null) {
							directions();
						}
					} else {
						alert('Geocode was not successful for the following reason: ' + status);
					}
				});
			}
			
			function codeDestination() {
				console.log("codeDestination");
				var address = document.getElementById("destination").value;
				geocoder.geocode( {'address' : address}, function(results, status) {
					if (status == 'OK') {
						marker.setMap(null);
						if (pointB !== null) {
							markerB.setMap(null);
						}
						pointB = results[0].geometry.location;
						map.setCenter(results[0].geometry.location);
						markerB = new google.maps.Marker({map: map, position: results[0].geometry.location});
						if (pointA != null) {
							directions();
						}
					} else {
						alert('Geocode was not successful for the following reason: ' + status);
					}
				});
			}
			
		//Showing directions
			
			function directions() {
				console.log("getting directions 1");
				var request = {
					origin: pointA,
					destination: pointB,
					travelMode: google.maps.TravelMode.DRIVING
				};
				directionsService.route(request, function(response, status) {
					if (status == google.maps.DirectionsStatus.OK) {
						markerA.setMap(null);
						markerB.setMap(null);
						directionsDisplay.setDirections(response);
					}
				});
				console.log("getting directions 4");
			}
			
			document.getElementById("start").addEventListener("keyup", function(event) {
				console.log("start enter press");
				event.preventDefault();
				if (event.keyCode == 13) {
					codeStart();
				}
			});
			
			document.getElementById("destination").addEventListener("keyup", function(event) {
				console.log("destination enter press");
				event.preventDefault();
				if (event.keyCode == 13) {
					codeDestination();
				}
			});
			
		</script>
		<script async defer
				src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDGf2V7XQSqJgEyp4oinoyA3dCyzb-CHn4&callback=initMap">
			
		</script>
  
		<footer class="container-fluid text-center">
			 &copy; UPool Team
		</footer>
	</body>
</html>